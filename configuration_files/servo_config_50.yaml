# servo control
#
# IMPORTANT: Keep output_channel values contiguous (no gaps between channels)!
# The PWM driver writes all channels in a single I2C transaction from min to max.
# Gaps waste I2C bandwidth. Current layout: ch 2-6 = 21 bytes per write.
# With gaps (e.g. ch 2-5 + ch 9) would need 33 bytes or multiple transactions.

# PCA9685 output signal frequency (Hz). Pulse widths and deadbands are tuned for this rate.
pwm_frequency: 50

CHANNEL_CONFIGS:

    pump:
        # TODO: update physical connection to match!
        output_channel: 9
        pulse_min: 1000
        pulse_max: 1700
        idle: 0.38
        multiplier: 0.4


    lift_boom:
        output_channel: 3  # output pin on the servo board
        affects_pump: True # whether moving this servo affects the pump speed (if set to variable)
        toggleable: False  # whether this servo can be toggled on/off via call
        center: 1570     # center pulse width in microseconds. Calculated automatically between min/max if set to None
        direction: 1       # pretty self-explanatory, -1 or 1
        pulse_min: 1360    # extend. This sets max velocity. Increase until arm doesn't go faster --> valve fully open
        pulse_max: 1760    # retract. Max velocity in other direction
        deadzone: 0.0      # % per direction

        deadband_us_pos: 166.0 # pos/neg offsets from center (us)
        deadband_us_neg: 168.0 # if these match, your center value is prob correct :)

        dither_enable: True # dither on/off. Adds vibration to reduce valve stiction.
        dither_amp_us: 25.0 # dither amplitude in microseconds (us)
        dither_hz: 11.0     # dither frequency in Hz
        dither_taper: False # taper dither near limits instead of expanding clamp

        ramp_enable: True    # linear slew limit on pulse changes
        ramp_limit: 700.0    # max rate in us/s; lower = smoother, less overshoot
        ramp_skip_deadband: False  # if True, deadband jump is instant (slew only for usable range)

        gamma: 1.0          # curve shaping; <1 = more sensitive near center



    tilt_boom:
        output_channel: 4
        affects_pump: True
        toggleable: False
        center: 1480
        direction: 1
        pulse_min: 1270     # ret
        pulse_max: 1720     # ext
        deadzone: 0.0
        deadband_us_pos: 158.0
        deadband_us_neg: 160.0
        dither_enable: True
        dither_amp_us: 25.0
        dither_hz: 11.0
        dither_taper: False
        ramp_enable: True
        ramp_limit: 1000.0
        ramp_skip_deadband: False
        gamma: 1.0

    scoop:
        output_channel: 2
        affects_pump: True
        toggleable: False
        center: 1392
        direction: -1       # ext/ret flipped!
        pulse_min: 1200     # ext 1220
        pulse_max: 1580     # ret
        deadzone: 0.0
        deadband_us_pos: 160.0
        deadband_us_neg: 162.0
        dither_enable: True
        dither_amp_us: 25.0
        dither_hz: 11.0
        dither_taper: False
        ramp_enable: True
        ramp_limit: 1000.0
        ramp_skip_deadband: False
        gamma: 1.0

    rotate:
        output_channel: 5
        affects_pump: False
        toggleable: False
        center: 1551
        direction: -1
        pulse_min: 1495
        pulse_max: 1620             #CW
        deadzone: 0.0
        deadband_us_pos: 51.0
        deadband_us_neg: 38.0
        dither_enable: False
        dither_amp_us: 10.0
        dither_hz: 50.0
        dither_taper: False
        ramp_enable: False
        ramp_limit: 250.0
        ramp_skip_deadband: False
        gamma: 1.5
