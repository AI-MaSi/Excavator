# General runtime configuration for excavator system

rates:
  # Controller (IK) loop frequency in Hz
  control_hz: 100.0

  # IMU expected sample rate in Hz (requested via handshake)
  imu_hz: 120.0

  # ADC/encoder read frequency in Hz
  adc_hz: 120.0

  # Optional PWM update cadence (if applicable in driver)
  pwm_update_hz: 100.0

perf:
  # Default enablement for low-level perf tracking (hardware)
  enabled_default: false

imu:
  # Optional IMU stream settings forwarded in handshake (device may clamp/ignore)
  lpf_enabled: 1
  lpf_alpha: 0.995
  qmode: FULL
  # TODO: rest of the filtering settings (currently requires recompile)


pwm:
  # PWM controller options forwarded to PCA9685 driver initialization
  pump_variable: False
  toggle_channels: False
  input_rate_threshold: 0

pid:
  # PID controller gains for each joint
  # Joint 0: Slew (base rotation)
  joint0:
    kp: 4.5 #5.0
    ki: 0.250
    kd: 0.75

  # Joint 1: Boom (lift arm)
  joint1:
    kp: 15.0 #13
    ki: 0.5
    kd: 0.0

  # Joint 2: Arm (tilt)
  joint2:
    kp: 7.0 #5
    ki: 0.50
    kd: 0.15

  # Joint 3: Bucket (scoop)
  joint3:
    kp: 5.0 #11
    ki: 0.50
    kd: 0.15

controller:
  # PID output limits (normalized -1.0 to 1.0)
  output_limits_min: -1.0
  output_limits_max: 1.0

  # Joint velocity limiting (applied at IK level for cleaner architecture)
  # Set to False to disable velocity limiting entirely
  enable_velocity_limiting: True

  # Per-joint velocity limits in rad/iter [slew, boom, arm, bucket]
  # Formula: rad/iter = degrees/sec / (57.3 * control_hz)
  # Examples at 100Hz:
  #   0.1 rad/iter = 5.73°/iter = 573°/s

  per_joint_max_velocity: [0.5, 1.0, 1.0, 1.0] #0.15

