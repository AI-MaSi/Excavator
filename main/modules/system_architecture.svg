<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 700">
  <!-- Define gradients and styles -->
  <defs>
    <!-- Layer gradients -->
    <linearGradient id="layerGradient1" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e8eaf6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#c5cae9;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="layerGradient2" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#fff3e0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#ffe0b2;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="layerGradient3" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f3e5f5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e1bee7;stop-opacity:1" />
    </linearGradient>
    
    <linearGradient id="layerGradient4" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e0f2f1;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#b2dfdb;stop-opacity:1" />
    </linearGradient>
    
    <!-- Drop shadow -->
    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
      <feOffset dx="0" dy="1" result="offsetblur"/>
      <feComponentTransfer>
        <feFuncA type="linear" slope="0.2"/>
      </feComponentTransfer>
      <feMerge>
        <feMergeNode/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    
    <style>
      .box {
        stroke: none;
        filter: url(#shadow);
      }
      .title-text {
        font-family: 'Manrope Light', 'Manrope', Arial, sans-serif;
        font-size: 14px;
        font-weight: 600;
        fill: #424242;
        text-anchor: middle;
      }
      .detail-text {
        font-family: 'Manrope Light', 'Manrope', Arial, sans-serif;
        font-size: 11px;
        font-weight: 300;
        fill: #616161;
        text-anchor: middle;
      }
      .layer-label {
        font-family: 'Manrope Light', 'Manrope', Arial, sans-serif;
        font-size: 10px;
        font-weight: 300;
        fill: #757575;
        text-anchor: start;
      }
      .arrow {
        stroke: #9e9e9e;
        stroke-width: 2;
        fill: none;
        marker-end: url(#arrowhead);
      }
      .feedback-arrow {
        stroke: #9e9e9e;
        stroke-width: 2;
        fill: none;
        stroke-dasharray: 4,3;
        marker-end: url(#arrowhead);
      }
    </style>
    
    <marker id="arrowhead" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#9e9e9e" />
    </marker>
  </defs>
  
  <!-- Layer labels on the left -->
  <text x="20" y="100" class="layer-label">PLANNING LAYER</text>
  <text x="20" y="240" class="layer-label">TASK-SPACE CONTROL</text>
  <text x="20" y="400" class="layer-label">JOINT-SPACE CONTROL</text>
  <text x="20" y="550" class="layer-label">HARDWARE LAYER</text>
  
  <!-- Layer 1: Path Planning (Top) -->
  <rect x="150" y="60" width="700" height="80" class="box" rx="8" fill="url(#layerGradient1)"/>
  <text x="500" y="90" class="title-text">Path Tracking Algorithms</text>
  <text x="500" y="108" class="detail-text">
A* / RRT* / PRM · Obstacle Avoidance</text>
  <text x="500" y="123" class="detail-text">Target Cartesian poses--></text>
  
  <!-- Arrow from Planning to IK -->
  <line x1="500" y1="140" x2="500" y2="185" class="arrow"/>
  
  <!-- Layer 2: IK Control -->
  <rect x="150" y="185" width="700" height="110" class="box" rx="8" fill="url(#layerGradient2)"/>
  <text x="500" y="215" class="title-text">Inverse Kinematics</text>
  <text x="500" y="233" class="detail-text">IKController (SVD / DLS / pinv / transpose)</text>
  <text x="500" y="248" class="detail-text">Jacobian computation · Singularity handling</text>
  <text x="500" y="263" class="detail-text">Cartesian pose → Joint angles</text>
  <text x="500" y="278" class="detail-text">Target: θ = [θ_slew, θ_boom, θ_arm, θ_bucket]</text>
  
  <!-- Arrow from IK to PID -->
  <line x1="500" y1="295" x2="500" y2="345" class="arrow"/>

  <!-- Layer 3: Joint PID Controllers -->
  <rect x="150" y="345" width="700" height="110" class="box" rx="8" fill="url(#layerGradient3)"/>
  <text x="500" y="375" class="title-text">PID Controllers (Joint Space)</text>
  
  <!-- Individual PID boxes -->
  <rect x="170" y="390" width="150" height="50" rx="5" fill="#ffffff" stroke="#9e9e9e" stroke-width="1"/>
  <text x="245" y="420" class="detail-text">PID: Slew</text>
  
  <rect x="340" y="390" width="150" height="50" rx="5" fill="#ffffff" stroke="#9e9e9e" stroke-width="1"/>
  <text x="415" y="420" class="detail-text">PID: Boom</text>
  
  <rect x="510" y="390" width="150" height="50" rx="5" fill="#ffffff" stroke="#9e9e9e" stroke-width="1"/>
  <text x="585" y="420" class="detail-text">PID: Arm</text>
  
  <rect x="680" y="390" width="150" height="50" rx="5" fill="#ffffff" stroke="#9e9e9e" stroke-width="1"/>
  <text x="755" y="420" class="detail-text">PID: Bucket</text>
  
  <!-- Arrows from PID to Hardware -->
  <line x1="245" y1="440" x2="245" y2="495" class="arrow"/>
  <line x1="415" y1="440" x2="415" y2="495" class="arrow"/>
  <line x1="585" y1="440" x2="585" y2="495" class="arrow"/>
  <line x1="755" y1="440" x2="755" y2="495" class="arrow"/>
  
  <!-- Layer 4: Hardware Interface - Parent Box -->
  <rect x="150" y="495" width="700" height="110" class="box" rx="8" fill="#f5f5f5" stroke="#bdbdbd" stroke-width="1.5"/>
  <text x="500" y="518" class="title-text">Hardware Layer</text>
  
  <!-- Sub-box: Valve Control (Left) -->
  <rect x="170" y="525" width="310" height="65" class="box" rx="6" fill="url(#layerGradient4)"/>
  <text x="325" y="545" class="detail-text" style="font-weight: 500;">Hydraulic Valve Control</text>
  <text x="325" y="560" class="detail-text">PWM Controller (PCA9685)</text>
  <text x="325" y="575" class="detail-text">Input preprocessing</text>
  
  <!-- Sub-box: Sensor Feedback (Right) -->
  <rect x="500" y="525" width="330" height="65" class="box" rx="6" fill="#e8f5e9"/>
  <text x="665" y="545" class="detail-text" style="font-weight: 500;">Sensor Feedback</text>
  <text x="665" y="560" class="detail-text">IMU Sensors (×3) · Encoder (Slew)</text>
  <text x="665" y="575" class="detail-text">Pressure sensors (optional)</text>
  
  <!-- Sensor feedback path (right side) -->
  <text x="880" y="100" class="layer-label" text-anchor="end">FEEDBACK</text>
  
  <!-- Feedback arrow: right from sensor box, up, then left to IK box -->
  <!-- Horizontal line going right from sensor box -->
  <line x1="830" y1="557" x2="880" y2="557" class="feedback-arrow"/>
  <!-- Vertical line going up -->
  <line x1="880" y1="557" x2="880" y2="240" class="feedback-arrow"/>
  <!-- Horizontal line going left to IK box -->
  <line x1="880" y1="240" x2="850" y2="240" class="feedback-arrow"/>
  
  <text x="895" y="400" class="detail-text" transform="rotate(-90 895 400)">Sensor measurements</text>
  <text x="910" y="400" class="detail-text" transform="rotate(-90 910 400)">(Quaternions)</text>
  
  <!-- Control loop frequency annotation -->
  <rect x="150" y="625" width="700" height="30" rx="5" fill="#fafafa" stroke="#bdbdbd" stroke-width="1"/>
  <text x="500" y="645" class="detail-text">Control Loop: 100 Hz</text>
  
</svg>